<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Heat-Check Director — Full Dashboard (Static Demo)</title>
<style>
  :root{
    --bg:#0b0f16; --panel:#0f1623; --muted:#7a8499; --text:#e7edf6; --brand:#60a5fa;
    --hot:#ef4444; --warm:#f59e0b; --icy:#38bdf8; --cold:#94a3b8; --card:#121a2a; --accent:#1f2b45;
    --green:#10b981; --red:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#0a0f18;color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  .wrap{max-width:1200px;margin:0 auto;padding:22px}
  .row{display:grid;gap:14px}
  .cols-2{grid-template-columns:1fr 1fr}
  .cols-3{grid-template-columns:1fr 1fr 1fr}
  .cols-4{grid-template-columns:1fr 1fr 1fr 1fr}
  .card{background:var(--panel);border:1px solid #1e2a42;border-radius:14px}
  .hd{padding:12px 14px 0}.bd{padding:12px 14px 14px}
  h1{font-size:20px;margin:0}.muted{color:var(--muted)}
  .tabs{display:flex;gap:8px}.btn-tab{background:#0f1729;border:1px solid #223052;color:#cbd5e1;padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn-tab.active{background:#1a2440;color:#fff}
  .btn{background:#0f1729;border:1px solid #223052;color:#cbd5e1;padding:8px 12px;border-radius:10px;cursor:pointer}
  .kpi{padding:12px 14px}.kpi .label{font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
  .kpi .value{font-size:22px;font-weight:700}
  .stage-pill{display:inline-flex;gap:8px;align-items:center;border-radius:999px;padding:6px 10px;font-weight:700}
  .Hot{background:rgba(239,68,68,.18);border:1px solid rgba(239,68,68,.35)} .Warm{background:rgba(245,158,11,.18);border:1px solid rgba(245,158,11,.35)}
  .Icy{background:rgba(56,189,248,.18);border:1px solid rgba(56,189,248,.35)} .Cold{background:rgba(148,163,184,.20);border:1px solid rgba(148,163,184,.35)}
  .chips{display:flex;gap:8px;flex-wrap:wrap}.chip{background:#10182a;border:1px solid #223052;border-radius:12px;padding:6px 10px;font-size:13px}
  .handoff{display:flex;gap:10px;align-items:center;background:linear-gradient(90deg,#172441,#1f2b4a);border:1px solid #223052;border-radius:12px;padding:12px 14px}
  .bar{height:8px;background:#1e293b;border-radius:999px;overflow:hidden}.bar>span{display:block;height:100%;background:linear-gradient(90deg,#93c5fd,#60a5fa)}
  .bar-val{font-size:12px;color:#cbd5e1;margin-top:6px}
  .tag{display:inline-block;border:1px solid #203155;border-radius:8px;padding:6px 8px;font-size:12px;color:#d6e2fb;margin:2px;cursor:pointer}
  .tag.active{background:#1a2a4a}
  table{border-collapse:separate;border-spacing:0;width:100%} th,td{padding:9px 10px;text-align:left}
  thead tr{background:#101a2d;color:#cbd5e1} tbody tr{background:#0f1623;border-top:1px solid #1e2a42} tbody tr:hover{background:#12203a}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12)}
  .l{background:rgba(16,185,129,.15);color:#bbf7d0}.s{background:rgba(239,68,68,.15);color:#fecaca}
  .qs{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:10px;font-size:12px;font-weight:700}
  .h{background:rgba(16,185,129,.12);color:#34d399;border:1px solid rgba(16,185,129,.3)}
  .m{background:rgba(245,158,11,.12);color:#fbbf24;border:1px solid rgba(245,158,11,.3)}
  .lq{background:rgba(244,63,94,.12);color:#fb7185;border:1px solid rgba(244,63,94,.3)}
  .area{width:100%;height:240px;background:#0d1424;border:1px solid #223052;border-radius:12px;position:relative}
  svg{position:absolute;inset:0}.axis{fill:#9fb3d9;font-size:11px}.grid{stroke:#1f2a42;stroke-width:1;opacity:.55}
  .legend{display:flex;gap:10px;flex-wrap:wrap}.dot{width:10px;height:10px;border-radius:50%;display:inline-block}
  .vol{background:#93c5fd}.breadth{background:#38bdf8}.credit{background:#34d399}.trend{background:#22d3ee}.news{background:#f59e0b}
  .timeline{display:flex;gap:2px;height:14px}.tl-Cold{background:var(--cold)}.tl-Icy{background:var(--icy)}.tl-Warm{background:var(--warm)}.tl-Hot{background:var(--hot)}
  .hint{font-size:12px;color:#e9d5ff;background:rgba(124,58,237,.15);border:1px solid rgba(124,58,237,.35);padding:6px 8px;border-radius:8px}
  .footer{font-size:12px;color:#93a3bf;margin-top:14px}
</style>
</head>
<body>
<div class="wrap">
  <!-- Header -->
  <div class="row" style="grid-template-columns:auto 1fr auto;align-items:center">
    <div style="display:flex;align-items:center;gap:10px">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M12 2 3 7v10l9 5 9-5V7z" stroke="#60a5fa" stroke-width="1.4"/></svg>
      <div><h1>Heat-Check Director — Full Dashboard</h1><div class="muted" style="font-size:12px">Static demo — dummy values only. No network calls.</div></div>
    </div>
    <div></div>
    <div class="tabs">
      <button class="btn-tab" data-mode="intraday">Intraday</button>
      <button class="btn-tab active" data-mode="eod">EOD</button>
      <button class="btn-tab" data-mode="weekly">Weekly</button>
      <button id="btn-beginner" class="btn" style="margin-left:8px">Beginner Mode: OFF</button>
    </div>
  </div>

  <!-- KPIs -->
  <div class="row cols-4" style="margin-top:14px">
    <div class="card"><div class="kpi"><div class="label">Stage</div><div class="value"><span id="stage" class="stage-pill Warm">Warm</span></div></div></div>
    <div class="card"><div class="kpi"><div class="label">Composite Heat Score</div><div id="kpi-chs" class="value">61/100</div></div></div>
    <div class="card"><div class="kpi"><div class="label">Tilt (Δ5d)</div><div id="kpi-tilt" class="value">+4</div></div></div>
    <div class="card"><div class="kpi"><div class="label">News Score (proxy)</div><div id="kpi-ns" class="value">+3</div></div></div>
  </div>

  <!-- Term structure + Handoff -->
  <div class="row cols-3" style="margin-top:14px">
    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">Volatility Term Structure</div></div>
      <div class="bd"><div class="chips">
        <div class="chip">State: <b id="term">Contango</b></div>
        <div class="chip">VIX: <b id="vix">15.7</b></div>
        <div class="chip">VIX3M: <b id="vix3m">18.9</b></div>
        <div class="chip">VIX9D: <b id="vix9d">15.1</b></div>
      </div></div>
    </div>
    <div class="card" style="grid-column:span 2">
      <div class="bd">
        <div class="handoff">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M13 5l7 7-7 7" stroke="#93c5fd" stroke-width="1.6"/></svg>
          <div>
            <div class="muted" style="font-size:12px">Director Handoff</div>
            <div id="handoff" style="font-size:16px;font-weight:700">Load Momentum Swing Warm Bull</div>
            <div class="muted" style="font-size:12px">The next module runs the swing screeners; Director remains classification-only.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row cols-3" style="margin-top:14px">
    <div class="card" style="grid-column:span 2">
      <div class="hd"><div class="muted" style="font-size:12px">Composite Heat Score</div></div>
      <div class="bd">
        <div class="area"><svg id="chs" viewBox="0 0 1000 240" preserveAspectRatio="none"></svg></div>
        <div id="chs-stats" class="muted" style="font-size:12px;margin-top:8px">Stats: —</div>
      </div>
    </div>
    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">Subscores (values & weights)</div></div>
      <div class="bd">
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:6px">Vol</div>
          <div class="bar"><span id="b-vol" style="width:72%"></span></div><div id="v-vol" class="bar-val">72 (w 25%) → 18.0</div>
        </div>
        <div style="margin-top:8px">
          <div class="muted" style="font-size:12px;margin-bottom:6px">Breadth</div>
          <div class="bar"><span id="b-breadth" style="width:64%"></span></div><div id="v-breadth" class="bar-val">64 (w 27%) → 17.3</div>
        </div>
        <div style="margin-top:8px">
          <div class="muted" style="font-size:12px;margin-bottom:6px">Credit</div>
          <div class="bar"><span id="b-credit" style="width:55%"></span></div><div id="v-credit" class="bar-val">55 (w 15%) → 8.3</div>
        </div>
        <div style="margin-top:8px">
          <div class="muted" style="font-size:12px;margin-bottom:6px">Trend</div>
          <div class="bar"><span id="b-trend" style="width:68%"></span></div><div id="v-trend" class="bar-val">68 (w 23%) → 15.6</div>
        </div>
        <div style="margin-top:8px">
          <div class="muted" style="font-size:12px;margin-bottom:6px">News</div>
          <div class="bar"><span id="b-news" style="width:52%"></span></div><div id="v-news" class="bar-val">52 (w 10%) → 5.2</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Blocks Over Time + Stage Timeline -->
  <div class="row cols-2" style="margin-top:14px">
    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">Blocks Over Time (with axis)</div></div>
      <div class="bd">
        <div class="legend" style="margin-bottom:6px">
          <span><i class="dot vol"></i>Vol</span><span><i class="dot breadth"></i>Breadth</span>
          <span><i class="dot credit"></i>Credit</span><span><i class="dot trend"></i>Trend</span>
          <span><i class="dot news"></i>News</span>
        </div>
        <div class="area" style="height:220px"><svg id="blocks" viewBox="0 0 1000 220" preserveAspectRatio="none"></svg></div>
        <div id="blocks-axis" class="muted" style="font-size:12px;margin-top:6px">Timeline: —</div>
      </div>
    </div>
    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">Stage Timeline (legend & streak)</div></div>
      <div class="bd">
        <div id="timeline" class="timeline"></div>
        <div id="timeline-legend" class="muted" style="font-size:12px;margin-top:8px">—</div>
      </div>
    </div>
  </div>

  <!-- Trader Workspace -->
  <div class="row" style="margin-top:18px;grid-template-columns:1fr auto">
    <div class="flex" style="align-items:center;gap:10px">
      <h2 style="margin:0;font-size:18px">Trader Workspace</h2>
      <span id="hint" class="hint" style="display:none">Beginner tip: Click any row to see Entry / Stop / T1 / Runner in the Inspector.</span>
    </div>
    <div>
      <span class="muted" style="font-size:12px;margin-right:6px">Quick Filters:</span>
      <span class="tag" data-filter="screener:MOMO">MOMO</span>
      <span class="tag" data-filter="screener:FLAG">FLAG</span>
      <span class="tag" data-filter="screener:REV">REV</span>
      <span class="tag" data-filter="side:Long">Longs</span>
      <span class="tag" data-filter="side:Short">Shorts</span>
    </div>
  </div>

  <div class="row cols-3" style="margin-top:10px">
    <!-- Market Overview (Index / VIX / Fear Grade) -->
    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">Market Overview</div></div>
      <div class="bd">
        <table id="tbl-market">
          <thead><tr><th>Instrument</th><th>Last</th><th>%Chg</th><th>20-d Trend</th><th>Note</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Top Stocks to Trade -->
    <div class="card" style="grid-column:span 2">
      <div class="hd"><div class="muted" style="font-size:12px">Top Stocks to Trade (Demo)</div></div>
      <div class="bd">
        <table id="tbl-trades">
          <thead>
            <tr>
              <th>Ticker</th><th>Screener</th><th>Stage</th><th>Side</th><th>Setup</th>
              <th>Entry</th><th>Stop</th><th>T1</th><th>Runner</th><th>R:R</th><th>QS</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Screener + Inspector -->
  <div class="row cols-3" style="margin-top:12px">
    <div class="card" style="grid-column:span 2">
      <div class="hd"><div class="muted" style="font-size:12px">Market Screener (Demo)</div></div>
      <div class="bd">
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:6px">
          <div><div class="muted" style="font-size:12px">Screener</div>
            <span class="tag" data-filter="screener:MOMO">MOMO</span>
            <span class="tag" data-filter="screener:FLAG">FLAG</span>
            <span class="tag" data-filter="screener:REV">REV</span>
          </div>
          <div><div class="muted" style="font-size:12px">Side</div>
            <span class="tag" data-filter="side:Long">Long</span>
            <span class="tag" data-filter="side:Short">Short</span>
          </div>
          <div><div class="muted" style="font-size:12px">QS</div>
            <span class="tag" data-filter="qs:80+">80+</span>
            <span class="tag" data-filter="qs:60-79">60–79</span>
            <span class="tag" data-filter="qs:lt60">&lt;60</span>
          </div>
          <div style="align-self:flex-end"><button id="clear" class="btn">Clear Filters</button></div>
        </div>
        <table id="tbl-screen">
          <thead>
            <tr>
              <th>Ticker</th><th>Screener</th><th>Stage</th><th>Side</th><th>Setup</th>
              <th>Entry</th><th>Stop</th><th>T1</th><th>Runner</th><th>R:R</th><th>QS</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">Inspector</div></div>
      <div class="bd" id="inspector"><div class="muted" style="font-size:13px">Click a row to preview a trade idea.</div></div>
    </div>
  </div>

  <!-- News & Triggers -->
  <div class="row cols-3" style="margin-top:16px">
    <div class="card" style="grid-column:span 2">
      <div class="hd"><div class="muted" style="font-size:12px">News Deck (demo)</div></div>
      <div class="bd" id="news"></div>
    </div>
    <div class="card">
      <div class="hd"><div class="muted" style="font-size:12px">If / Then Triggers (next 1–3 sessions)</div></div>
      <div class="bd">
        <ul style="margin:0;padding-left:18px;line-height:1.7">
          <li>If VIX > VIX3M for 2 closes → downgrade to Icy.</li>
          <li>If %SPX&gt;50-DMA &lt; 50% → downgrade to Icy.</li>
          <li>If HYG/TLT 5-day ROC &lt; −1% → cut Credit block one tier.</li>
          <li>If NS ≤ −25 on CPI/FOMC → immediate Icy override.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="footer">Demo only. To wire this to your engine, bind DOM setters to your Director API or local JSON snapshots. Nothing here is investment advice.</div>
</div>

<script>
(function(){
  // --- Generators (dummy) ---
  function genSeries(n, seed){var o=[],chs=seed||61;for(var i=n-1;i>=0;i--){var d=new Date();d.setDate(d.getDate()-i);var drift=(Math.sin(i/9)+Math.cos(i/5))*2;chs=Math.max(10,Math.min(90,chs+(Math.random()-.5)*5+drift*.3));var vol=60+Math.sin(i/4)*15+(Math.random()-.5)*8;var br=55+Math.cos(i/6)*20+(Math.random()-.5)*10;var cr=50+Math.sin(i/7)*18+(Math.random()-.5)*8;var tr=58+Math.cos(i/8)*16+(Math.random()-.5)*6;var nw=50+Math.sin(i/10)*14+(Math.random()-.5)*10;var st="Warm";if(chs>=65)st="Hot";else if(chs<35)st="Cold";else if(chs<50)st="Icy";o.push({date:d.toISOString(),chs:Math.round(chs),vol:~~vol,breadth:~~br,credit:~~cr,trend:~~tr,news:~~nw,stage:st});}return o;}
  function genSpark(n, drift){var o=[],v=50;for(var i=0;i<n;i++){v=v+(Math.random()-.5)*8+(drift||0);o.push(Math.max(0,Math.min(100,v)));}return o;}
  function sparkPath(a){var W=120,H=26,s=W/(a.length-1),p='';for(var i=0;i<a.length;i++){var x=i*s,y=H-(a[i]/100)*H;p+=(i? 'L':'M')+x+','+y+' ';}return '<path d="'+p+'" stroke="#7aa2ff" stroke-width="1.6" fill="none"/>';}

  var DATA={
    eod:{ series:genSeries(90,62), ns:+3, term:{vix:15.7,vix3m:18.9,vix9d:15.1} },
    intraday:{ series:genSeries(60,58), ns:+1, term:{vix:16.1,vix3m:19.0,vix9d:16.3} },
    weekly:{ series:genSeries(52,60), ns:0, term:{vix:15.4,vix3m:18.6,vix9d:14.9} }
  };

  var MARKET=[
    { name:"S&P 500", code:"SPX", last:5534.1, chg:+0.6, note:"Above 50/200-DMA", spark: genSpark(20, 0.4) },
    { name:"Nasdaq 100", code:"NDX", last:20012.4, chg:+0.9, note:"Leadership intact", spark: genSpark(20, 0.7) },
    { name:"Russell 2000", code:"IWM", last:201.8, chg:-0.2, note:"Small-cap lag", spark: genSpark(20,-0.2) },
    { name:"VIX", code:"VIX", last:15.7, chg:-4.1, note:"Contango", spark: genSpark(20,-0.5) },
    { name:"Fear Grade", code:"FGI", last:62, chg:+3.0, note:"Greed", spark: genSpark(20, 0.2) }
  ];

  var TRADES=[
    { screener:"MOMO", stage:"Hot",  ticker:"NVDA", side:"Long",  setup:"Flag breakout",        entry:128.2, stop:124.9, t1:133.0, runner:"10EMA", rr:1.6, quality:89 },
    { screener:"PEG",  stage:"Warm", ticker:"AAPL", side:"Long",  setup:"Pullback to 20SMA",    entry:232.5, stop:228.9, t1:238.0, runner:"20EMA", rr:1.5, quality:78 },
    { screener:"REV",  stage:"Icy",  ticker:"TSLA", side:"Short", setup:"Failed retest",        entry:260.0, stop:266.5, t1:247.0, runner:"10EMA", rr:1.9, quality:74 },
    { screener:"FLAG", stage:"Hot",  ticker:"SMH",  side:"Long",  setup:"Breadth thrust",       entry:266.8, stop:261.0, t1:275.5, runner:"10EMA", rr:1.7, quality:83 },
    { screener:"REV",  stage:"Cold", ticker:"IWM",  side:"Short", setup:"Bear flag",            entry:202.2, stop:206.8, t1:195.4, runner:"20EMA", rr:1.6, quality:69 }
  ];

  var NEWS=[
    {tag:"[V] Rates/Liquidity",score:+6,headline:"Powell hints at cut if disinflation continues",source:"Reuters",t:new Date().toLocaleString()},
    {tag:"[V] Micro",score:+3,headline:"Mega-cap beats; buybacks extended",source:"FT",t:new Date(Date.now()-2*3600000).toLocaleString()},
    {tag:"[V] Inflation",score:-2,headline:"PPI a touch hot; services up",source:"WSJ",t:new Date(Date.now()-8*3600000).toLocaleString()},
    {tag:"[D] Geo/Energy",score:-3,headline:"Oil firm on supply chatter; OPEC in focus",source:"Bloomberg",t:new Date(Date.now()-10*3600000).toLocaleString()}
  ];

  var WEIGHTS={vol:.25,breadth:.27,credit:.15,trend:.23,news:.10};
  var mode="eod", beginner=false, filters=[];

  function $(id){return document.getElementById(id)}
  function fmt(n){return (n>0?"+":"")+n}
  function money(n){return "$"+n.toFixed(2)}
  function qsClass(q){return q>=80?"qs h":(q>=60?"qs m":"qs lq")}
  function derive(series){
    var last=series[series.length-1], idx=Math.max(0,series.length-6);
    var tilt=last.chs-series[idx].chs, ns=DATA[mode].ns, term=DATA[mode].term, contango=term.vix < term.vix3m;
    return {last: last, tilt: tilt, ns: ns, term: term, contango: contango, stage:last.stage, series:series};
  }

  // Charts
  function drawArea(svgId, arr, meta){
    var svg=$(svgId); svg.innerHTML="";
    var W=1000,H=240,n=arr.length,max=100,min=0,xs=W/(n-1);
    [0,25,50,75,100].forEach(function(v){var y=H-(v-min)/(max-min)*H;line(svg,0,y,W,y,"grid");text(svg,4,y-4,"axis",v);});
    var d=""; for(var i=0;i<n;i++){var x=i*xs,y=H-(arr[i]-min)/(max-min)*H; d+=(i?"L":"M")+x+","+y+" "; }
    path(svg,d+" L"+W+","+H+" L0,"+H+" Z","#60a5fa22",null,0);
    path(svg,d,"#93c5fd",null,2);
    circ(svg,(n-1)*xs,H-(arr[n-1]-min)/(max-min)*H,3.5,"#60a5fa");
    var a=meta.series; var first=new Date(a[0].date).toLocaleDateString(), mid=new Date(a[Math.floor(n/2)].date).toLocaleDateString(), last=new Date(a[n-1].date).toLocaleDateString();
    text(svg,6,H-4,"axis",first); text(svg,W/2,H-4,"axis",mid); text(svg,W-60,H-4,"axis",last);
  }
  function drawLines(svgId, series, meta){
    var svg=$(svgId); svg.innerHTML=""; var col={vol:"#93c5fd",breadth:"#38bdf8",credit:"#34d399",trend:"#22d3ee",news:"#f59e0b"};
    var W=1000,H=220,keys=Object.keys(series),n=series[keys[0]].length,xs=W/(n-1);
    [0,25,50,75,100].forEach(function(v){var y=H-(v/100)*H;line(svg,0,y,W,y,"grid");text(svg,4,y-4,"axis",v);});
    keys.forEach(function(k){
      var a=series[k], d=""; for(var i=0;i<n;i++){var x=i*xs,y=H-(a[i]/100)*H; d+=(i?"L":"M")+x+","+y+" "; }
      path(svg,d,col[k],null,1.8);
    });
    var s=meta.series; var first=new Date(s[0].date).toLocaleDateString(), last=new Date(s[n-1].date).toLocaleDateString();
    $("blocks-axis").textContent="Timeline: "+first+" → "+last;
  }
  function path(svg,d,stroke,fill,sw){var p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",d);if(fill!=null)p.setAttribute("fill",fill);else p.setAttribute("fill","none");if(stroke)p.setAttribute("stroke",stroke);if(sw)p.setAttribute("stroke-width",sw);svg.appendChild(p);}
  function line(svg,x1,y1,x2,y2,cls){var l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",x1);l.setAttribute("x2",x2);l.setAttribute("y1",y1);l.setAttribute("y2",y2);l.setAttribute("class",cls);svg.appendChild(l);}
  function text(svg,x,y,cls,t){var tx=document.createElementNS("http://www.w3.org/2000/svg","text");tx.setAttribute("x",x);tx.setAttribute("y",y);tx.setAttribute("class",cls);tx.textContent=t;svg.appendChild(tx);}
  function circ(svg,x,y,r,fill){var c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",x);c.setAttribute("cy",y);c.setAttribute("r",r);c.setAttribute("fill",fill);svg.appendChild(c);}

  // Renders
  function render(){
    var s=DATA[mode].series, d=derive(s), last=d.last;

    // KPIs
    $("stage").textContent=d.stage; $("stage").className="stage-pill "+d.stage;
    $("kpi-chs").textContent=last.chs+"/100"; $("kpi-tilt").textContent=fmt(Math.round(d.tilt)); $("kpi-ns").textContent=fmt(d.ns);
    $("term").textContent=d.contango? "Contango":"Backwardation";
    $("vix").textContent=d.term.vix.toFixed(1); $("vix3m").textContent=d.term.vix3m.toFixed(1); $("vix9d").textContent=d.term.vix9d.toFixed(1);
    $("handoff").textContent=(d.stage==="Hot"?"Load Momentum Swing Hot Bull":d.stage==="Warm"?"Load Momentum Swing Warm Bull":d.stage==="Icy"?"Momentum Swing Icy Bear":"Momentum Swing Cold Bear");

    // Subscores & contributions
    $("b-vol").style.width=Math.min(100,Math.max(0,last.vol))+"%"; $("v-vol").textContent=last.vol+" (w 25%) → "+(last.vol*WEIGHTS.vol).toFixed(1);
    $("b-breadth").style.width=Math.min(100,Math.max(0,last.breadth))+"%"; $("v-breadth").textContent=last.breadth+" (w 27%) → "+(last.breadth*WEIGHTS.breadth).toFixed(1);
    $("b-credit").style.width=Math.min(100,Math.max(0,last.credit))+"%"; $("v-credit").textContent=last.credit+" (w 15%) → "+(last.credit*WEIGHTS.credit).toFixed(1);
    $("b-trend").style.width=Math.min(100,Math.max(0,last.trend))+"%"; $("v-trend").textContent=last.trend+" (w 23%) → "+(last.trend*WEIGHTS.trend).toFixed(1);
    $("b-news").style.width=Math.min(100,Math.max(0,last.news))+"%"; $("v-news").textContent=last.news+" (w 10%) → "+(last.news*WEIGHTS.news).toFixed(1);

    // CHS chart + stats
    drawArea("chs", s.map(function(p){return p.chs;}), d);
    var chsMin=Math.min.apply(null,s.map(function(p){return p.chs;})), chsMax=Math.max.apply(null,s.map(function(p){return p.chs;}));
    var chsAvg=(s.reduce(function(a,b){return a+b.chs;},0)/s.length).toFixed(1);
    $("chs-stats").textContent="Stats: Min "+chsMin+" | Max "+chsMax+" | Avg "+chsAvg+" | Last "+last.chs+" | 5d Δ "+fmt(Math.round(d.tilt));

    // Blocks chart
    drawLines("blocks", {
      vol: s.map(function(p){return p.vol;}), breadth: s.map(function(p){return p.breadth;}), credit: s.map(function(p){return p.credit;}), trend: s.map(function(p){return p.trend;}), news: s.map(function(p){return p.news;})
    }, d);

    // Stage timeline + legend
    var tl=$("timeline"); tl.innerHTML=""; var counts={Hot:0,Warm:0,Icy:0,Cold:0};
    for(var i=0;i<s.length;i++){var st=s[i].stage; counts[st]++; var seg=document.createElement("div"); seg.style.flex="1"; seg.className="tl-"+st; tl.appendChild(seg);}
    var cur=s[s.length-1].stage, streak=1; for(var k=s.length-2;k>=0;k--){if(s[k].stage===cur) streak++; else break;}
    function pct(n){return Math.round(n/s.length*100)}
    $("timeline-legend").textContent="Hot "+pct(counts.Hot)+"% | Warm "+pct(counts.Warm)+"% | Icy "+pct(counts.Icy)+"% | Cold "+pct(counts.Cold)+"% • Current: "+cur+" ("+streak+" d)";

    // Market Overview
    var tb=$("tbl-market").querySelector("tbody"); tb.innerHTML="";
    MARKET.forEach(function(r){
      var tr=document.createElement("tr");
      tr.innerHTML="<td>"+r.name+"</td>"+
                   "<td>"+(r.code==="FGI"? r.last.toFixed(0):(r.code==="VIX"? r.last.toFixed(1):r.last.toFixed(2)))+"</td>"+
                   "<td><span style='color:"+(r.chg>=0?"#34d399":"#fb7185")+"'>"+(r.chg>=0?"+":"")+r.chg.toFixed(1)+"%</span></td>"+
                   "<td><svg width='120' height='26'>"+sparkPath(r.spark)+"</svg></td>"+
                   "<td>"+r.note+"</td>";
      tb.appendChild(tr);
    });

    // Trades + Screener (filtered)
    renderTrades("tbl-trades");
    renderTrades("tbl-screen");

    // News
    var nl=$("news"); nl.innerHTML="";
    NEWS.forEach(function(it){
      var row=document.createElement("div"); row.style.display="flex"; row.style.gap="8px"; row.style.marginBottom="8px";
      var badge=document.createElement("span"); badge.className="qs "+(it.score>=0?"h":"lq"); badge.textContent=(it.score>=0?"+":"")+it.score;
      var txt=document.createElement("div"); txt.innerHTML="<div><b>"+it.tag+"</b> — "+it.headline+"</div><div class='muted' style='font-size:12px'>"+it.source+" • "+it.t+"</div>";
      row.appendChild(badge); row.appendChild(txt); nl.appendChild(row);
    });

    $("hint").style.display = beginner? "inline-flex":"none";
  }

  function applyFilters(list){
    if(!filters.length) return list;
    return list.filter(function(r){
      return filters.every(function(f){
        if(f.type==="screener") return r.screener===f.value;
        if(f.type==="side") return r.side===f.value;
        if(f.type==="qs"){
          if(f.value==="80+") return r.quality>=80;
          if(f.value==="60-79") return r.quality>=60 && r.quality<80;
          if(f.value==="lt60") return r.quality<60;
        }
        return true;
      });
    });
  }

  function renderTrades(tableId){
    var rows=applyFilters(TRADES.slice());
    var tb=$(tableId).querySelector("tbody"); tb.innerHTML="";
    rows.forEach(function(r){
      var tr=document.createElement("tr");
      var pill="<span class='pill "+(r.side==="Long"?"l":"s")+"'>"+r.side+"</span>";
      var qsb="<span class='"+qsClass(r.quality)+"'>QS "+r.quality+"</span>";
      tr.innerHTML="<td>"+r.ticker+"</td><td>"+r.screener+"</td><td>"+r.stage+"</td><td>"+pill+"</td>"+
                   "<td>"+r.setup+"</td><td>"+money(r.entry)+"</td><td>"+money(r.stop)+"</td><td>"+money(r.t1)+"</td>"+
                   "<td>"+r.runner+"</td><td>"+r.rr.toFixed(1)+"</td><td>"+qsb+"</td>";
      tr.addEventListener("click",function(){inspect(r);});
      tb.appendChild(tr);
    });
  }

  function inspect(r){
    $("inspector").innerHTML=
      "<div style='display:flex;justify-content:space-between;align-items:center'><div style='font-weight:700'>"+r.ticker+" • "+r.screener+"</div><div class='"+qsClass(r.quality)+"'>QS "+r.quality+"</div></div>"+
      "<div class='muted' style='margin-top:6px'>Stage <b>"+r.stage+"</b> • Side <b>"+r.side+"</b></div>"+
      "<div style='margin-top:8px'>Setup: <b>"+r.setup+"</b></div>"+
      "<div class='row cols-3' style='gap:8px;margin-top:8px'>"+
        stat("Entry",money(r.entry))+stat("Stop",money(r.stop))+stat("T1",money(r.t1))+
      "</div>"+
      "<div style='margin-top:8px'>Runner: <b>"+r.runner+"</b> • R:R <b>"+r.rr.toFixed(1)+"</b></div>"+
      (beginner?"<div class='hint' style='margin-top:8px'>Entry is the trigger; Stop protects capital; T1 is where half is taken; the rest trails by EMA.</div>":"");
  }
  function stat(k,v){return "<div class='card' style='padding:8px 10px'><div class='muted' style='font-size:11px'>"+k+"</div><div style='font-weight:700'>"+v+"</div></div>";}

  // Events
  function bind(){
    document.querySelectorAll(".btn-tab").forEach(function(b){
      b.addEventListener("click",function(){
        document.querySelectorAll(".btn-tab").forEach(function(x){x.classList.remove("active")});
        this.classList.add("active"); mode=this.getAttribute("data-mode"); render();
      });
    });
    document.getElementById("btn-beginner").addEventListener("click",function(){
      beginner=!beginner; this.textContent="Beginner Mode: "+(beginner?"ON":"OFF"); render();
    });
    document.querySelectorAll(".tag").forEach(function(t){
      t.addEventListener("click",function(){
        var f=this.getAttribute("data-filter").split(":"); var type=f[0], value=f[1];
        var i=filters.findIndex(function(x){return x.type===type && x.value===value;});
        if(i>=0){filters.splice(i,1); this.classList.remove("active");}
        else{filters.push({type:type,value:value}); this.classList.add("active");}
        renderTrades("tbl-trades"); renderTrades("tbl-screen");
      });
    });
    document.getElementById("clear").addEventListener("click",function(){
      filters=[]; document.querySelectorAll(".tag").forEach(function(x){x.classList.remove("active")});
      renderTrades("tbl-trades"); renderTrades("tbl-screen");
    });
  }

  // Init
  bind(); render();
})();
</script>
</body>
</html>
